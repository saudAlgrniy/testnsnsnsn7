<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تشغيل الفيديو مع الترجمة باستخدام Video.js</title>

    <!-- تضمين CSS لمكتبة Video.js -->
    <link href="https://vjs.zencdn.net/8.0.4/video-js.css" rel="stylesheet" />

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        .video-js {
            width: 80%;
            max-width: 600px;
        }
        /* تنسيق الترجمة */
        .vjs-text-track {
            font-size: 24px;
            color: yellow;
            background-color: transparent !important;
            text-shadow: none;
        }
    </style>
</head>
<body>

    <h1>تشغيل الفيديو مع الترجمة</h1>
    <input type="text" id="videoUrl" placeholder="أدخل رابط الفيديو هنا">
    <input type="file" id="vttFile" accept=".vtt">
    <button onclick="loadVideo()">تشغيل الفيديو</button>

    <!-- مشغل فيديو باستخدام Video.js -->
    <video
      id="videoPlayer"
      class="video-js vjs-default-skin"
      controls
      preload="auto"
      data-setup='{}'>
      <source id="videoSource" src="" type="video/mp4">
      <track kind="subtitles" src="" srclang="ar" label="Arabic" id="subtitleTrack">
      الفيديو غير مدعوم.
    </video>

    <!-- تضمين JavaScript لمكتبة Video.js -->
    <script src="https://vjs.zencdn.net/8.0.4/video.min.js"></script>

    <script>
        function loadVideo() {
            const url = document.getElementById('videoUrl').value;
            const videoSource = document.getElementById('videoSource');
            videoSource.src = url;

            const videoPlayer = videojs('videoPlayer'); // تهيئة Video.js
            videoPlayer.load();

            const fileInput = document.getElementById('vttFile');
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();

                reader.onload = function(e) {
                    const vttData = e.target.result;
                    addCuesToVideo(vttData, videoPlayer);
                };

                reader.readAsText(file);
            }
        }

        function addCuesToVideo(vttData, videoPlayer) {
            const track = videoPlayer.textTracks()[0]; // الوصول إلى مسار الترجمة
            const lines = vttData.split('\n');
            
            let cueText = "";
            let startTime = null;
            let endTime = null;

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line.startsWith("vttcue")) {
                    const cueMatch = line.match(/vttcue\(([^,]+), ([^)]+)\)/);
                    if (cueMatch) {
                        // إذا كانت هناك ترجمة سابقة لم تُضف بعد، أضفها
                        if (cueText) {
                            track.addCue(new VTTCue(startTime, endTime, cueText.trim()));
                            cueText = "";
                        }

                        startTime = parseFloat(cueMatch[1]);
                        endTime = parseFloat(cueMatch[2]);
                    }
                } else if (line !== "") {
                    cueText += line + "\n";
                }
            }

            // إضافة الترجمة الأخيرة إن وجدت
            if (cueText) {
                track.addCue(new VTTCue(startTime, endTime, cueText.trim()));
            }
        }
    </script>

</body>
</html>